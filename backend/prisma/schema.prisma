generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
  
}

datasource db {
  provider = "postgresql"
}


model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String?  // Nullable for OAuth-only users
  name      String?
  avatar    String?
  provider  String   @default("local") // 'local', 'google', 'github'
  
  // specific IDs  to support account linking strictly
  googleId  String?  @unique
  githubId  String?  @unique

  passwordResetToken     String?  
  passwordResetExpires   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  // --- USER SETTINGS ---
  defaultRefillLink String?

  clients   Client[]
}



enum ClientStatus {
  ACTIVE    // Normal state: Can add logs
  PAUSED    // Frozen: Cannot add logs, but Client can still view history
  ARCHIVED  // Hidden/Closed: Work is done
}


model Client {
  id          String   @id @default(uuid())

  // --- OWNERSHIP ---
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // --- PUBLIC ACCESS ---
  // The public URL slug (e.g. retain.app/acme-corp)
  slug        String   @unique

  // --- CLIENT DETAILS ---
  name        String
  status      ClientStatus @default(ACTIVE)
  
  // Payment Link (Stripe/PayPal/Invoice)
  refillLink  String?

  // --- FINANCIALS ---
  // The "Contract Size" (e.g., 20 hours). Used to calculate revenue potential.
  totalHours  Decimal  @default(0.00) @db.Decimal(10, 2)

  // The "Live Balance". Updated automatically when logs are added.
  currentBalance  Decimal  @default(0.00) @db.Decimal(10, 2)

  // Revenue Calculation: (hourlyRate * totalHours)
  hourlyRate  Decimal  @default(0.00) @db.Decimal(10, 2) 
  currency    String   @default("USD")

  // --- TIMESTAMPS ---
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // --- RELATIONS ---
  logs        WorkLog[]
}


enum LogType {
  WORK
  REFILL
}

model WorkLog {
  id          String   @id @default(uuid())
  description String
  
  // The amount of time spent on this specific task
  hours       Decimal  @db.Decimal(5, 2)
  
  // When the work was actually done (allows back-dating logs)
  date        DateTime @default(now())

  //  (Default to WORK so existing logs don't break)
  type        LogType  @default(WORK)

  // Relation fields
  clientId    String
  client      Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}